DROP TABLE USER_TABLE;
DROP TABLE ACCOUNT_TABLE;
DROP TABLE SUPERUSER_TABLE;
DROP SEQUENCE SQ_USER_TABLE_PK;
DROP SEQUENCE SQ_SUPERUSER_TABLE_PK;
DROP SEQUENCE SQ_ACCOUNT_ID_PK;

CREATE TABLE USER_TABLE (
    USER_ID INTEGER PRIMARY KEY, 
    USER_USERNAME VARCHAR2(100) UNIQUE NOT NULL,
    USER_USERPASS VARCHAR2(100) NOT NULL,
    USER_FIRSTNAME VARCHAR2(100) NOT NULL,
    USER_LASTNAME VARCHAR2(100) NOT NULL,
    USER_EMAIL VARCHAR2(100) UNIQUE NOT NULL
);

CREATE TABLE ACCOUNT_TABLE (
    BANK_ACCOUNT_ID NUMBER PRIMARY KEY, 
    USER_ID INTEGER, --FK
    BALANCE FLOAT DEFAULT 0.0,
    DEPOSIT FLOAT DEFAULT 0.0,
    WITHDRAW FLOAT DEFAULT 0.0    
);

CREATE TABLE SUPERUSER_TABLE (
SUPERUSER_ID NUMBER PRIMARY KEY,
SUPERUSER_USERNAME VARCHAR2(100) UNIQUE NOT NULL,
SUPERUSER_PASSWORD VARCHAR2(100) NOT NULL
);

-- alter table to add fk constraint
ALTER TABLE ACCOUNT_TABLE 
ADD FOREIGN KEY (USER_ID) REFERENCES USER_TABLE(USER_ID);
/

--ALTER TABLE USER_TABLE DROP (USER_ID) CASCADE CONSTRAINTS;

CREATE SEQUENCE SQ_USER_TABLE_PK --FOR USER ID USER TBALE
START WITH 100
INCREMENT BY 1;
/

CREATE SEQUENCE SQ_SUPERUSER_TABLE_PK --FOR SUPERUSER_ID    -- SUPERUSER
START WITH 1
INCREMENT BY 1;
/

CREATE SEQUENCE SQ_ACCOUNT_ID_PK -- FOR ACCOUNT_ID
START WITH 1000
INCREMENT BY 1;
/
-- trigger
CREATE OR REPLACE TRIGGER TR_INSERT_USER_TABLE      --USER TBALE TIRGGER
BEFORE INSERT ON USER_TABLE --SPECIFY OPERATION, BEFORE/AFTER, AND TABLE 
FOR EACH ROW
BEGIN
    SELECT SQ_USER_TABLE_PK.NEXTVAL INTO :NEW.USER_ID FROM DUAL;
END;
/

CREATE OR REPLACE TRIGGER TR_INSERT_ACCOUNT_ID  --ACCOUNT ID TIRGGER
BEFORE INSERT ON ACCOUNT_TABLE
FOR EACH ROW
BEGIN
    SELECT SQ_ACCOUNT_ID_PK.NEXTVAL INTO :NEW.BANK_ACCOUNT_ID FROM DUAL;
END;
/

CREATE OR REPLACE TRIGGER TR_INSERT_SUPERUSER_TABLE    ---SUPERUSER TABEL
BEFORE INSERT ON SUPERUSER_TABLE
FOR EACH ROW
BEGIN
    SELECT SQ_SUPERUSER_TABLE_PK.NEXTVAL INTO :NEW.SUPERUSER_ID FROM DUAL;
END;
/

--TESTS 
--
INSERT INTO USER_TABLE (USER_USERNAME,USER_USERPASS,USER_FIRSTNAME,USER_LASTNAME,USER_EMAIL) 
VALUES ('BOB','BOBSPASS','FIRSTNAME','LASTNAME','YME@GMAIL.COM');

--
INSERT INTO USER_TABLE (USER_USERNAME,USER_USERPASS,USER_FIRSTNAME,USER_LASTNAME,USER_EMAIL) 
VALUES ('TOM','BOBS','BOBFIRSTNAME','BOSLAST','YOMAMA@GMAIL.COM');

INSERT INTO USER_TABLE (USER_USERNAME,USER_USERPASS,USER_FIRSTNAME,USER_LASTNAME,USER_EMAIL) 
VALUES ('TOMMY','BOBBBY','TOMMYFIRSTNAME','BBOSLAST','BYOMAMA@GMAIL.COM');
----
INSERT INTO USER_TABLE (USER_USERNAME,USER_USERPASS,USER_FIRSTNAME,USER_LASTNAME,USER_EMAIL) 
VALUES ('T','B','T','B','BBYOMAMA@GMAIL.COM');


INSERT INTO ACCOUNT_TABLE (BALANCE,DEPOSIT,WITHDRAW) VALUES (100,100,200);

INSERT INTO ACCOUNT_TABLE (BALANCE,DEPOSIT,WITHDRAW) VALUES (0.0,2,1);

INSERT INTO SUPERUSER_TABLE (SUPERUSER_USERNAME, SUPERUSER_PASSWORD) VALUES ('TOM','JERRY');